<ion-header mode="ios" class="home">
  <ion-toolbar>
    <div class="logo" slot="start">
      <ion-img src="assets/img/ePoc.svg"></ion-img>
      <ion-img class="by-inria" src="assets/img/ePoc-by-Inria-seul.svg"></ion-img>
    </div>
    <ion-button class="icon-btn" slot="end" routerLink="/settings" routerDirection="forward">
      <ion-icon slot="icon-only" name="settings-outline" color="inria-blue"></ion-icon>
    </ion-button>
    <ion-button class="icon-btn" slot="end" routerLink="/about" routerDirection="forward">
      <ion-icon slot="icon-only" name="information-circle-outline" color="inria-blue"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="library">
  <ion-refresher slot="fixed" snapbackDuration="1000ms" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <ion-slides class="onboarding" *ngIf="onboarding && onboarding.length" [options]="onboardingOptions" [pager]="onboarding.length > 1 ? 'true' : ''">
    <ion-slide class="onboarding-item" [ngClass]="item.image ? 'with-image':''" *ngFor="let item of onboarding">
      <div class="onboarding-item-image" *ngIf="item.image" [style]="'background-image:url('+item.image+')'"></div>
      <div class="onboarding-item-title">{{item.title}}</div>
      <div class="onboarding-item-text">{{item.text}}</div>
      <a [routerLink]="item.link.url" *ngIf="item.link">{{item.link.text}}</a>
      <div class="onboarding-item-close" (click)="removeMessage(item.id)">
        <ion-icon name="close-outline" color="inria-lightgrey"></ion-icon>
      </div>
    </ion-slide>
  </ion-slides>
  <div class="library-items">
    <div class="library-item" *ngFor="let epoc of library">
      <div class="library-item-image" [routerLink]="'/library/'+epoc.id" [style]="'background-image:url('+epoc.image+')'"></div>
      <h3 class="library-item-title">{{epoc.title}}</h3>
      <div class="library-item-toolbar" *ngIf="epoc.downloaded">
        <ion-button class="expanded" color="inria" [routerLink]="'/epoc/toc/'+epoc.id">
          <span *ngIf="!epoc.opened">Découvrir</span>
          <span *ngIf="epoc.opened">Continuer</span>
          <ion-icon *ngIf="epoc.opened" name="arrow-forward-outline" slot="end"></ion-icon>
        </ion-button>
        <ion-button class="round" [ngClass]="{'update-available': epoc.updateAvailable}" color="inria-light" (click)="openEpocMenu(epoc)">
          <span class="ellipsis">...</span>
        </ion-button>
      </div>
      <div class="library-item-toolbar" *ngIf="!epoc.downloading && !epoc.downloaded && !epoc.unzipping">
        <ion-button class="expanded" color="inria-light" (click)="downloadEpoc(epoc)">
          <ion-icon name="cloud-download-outline" slot="start"></ion-icon>
          <span>Télécharger</span>
        </ion-button>
      </div>
      <div class="library-item-toolbar" *ngIf="epoc.downloading">
        <ion-button class="expanded" disabled="true" color="inria-light">
          <ion-icon name="sync-outline" class="spin" slot="start"></ion-icon>
          <span>Téléchargement <ng-container *ngIf="epocProgresses[epoc.id]">({{epocProgresses[epoc.id]}}%)</ng-container></span>
        </ion-button>
      </div>
      <div class="library-item-toolbar" *ngIf="epoc.unzipping">
        <ion-button class="expanded" disabled="true" color="inria-light">
          <ion-icon name="cog-outline" class="spin" slot="start"></ion-icon>
          <span>Ouverture du zip<ng-container *ngIf="epocProgresses[epoc.id]">({{epocProgresses[epoc.id]}}%)</ng-container></span>
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>

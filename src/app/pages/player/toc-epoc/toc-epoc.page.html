<ion-header #header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button text="Retour" color="inria-blue"></ion-back-button>
        </ion-buttons>
        <ion-title>Tables des mati√®res</ion-title>
        <ion-toggle slot="end" color="inria-blue" [(ngModel)]="detailedToc"></ion-toggle>
    </ion-toolbar>
</ion-header>

<ion-content *ngIf="epoc$ | async as epoc">
    <ng-container *ngIf="detailedToc">
        <ion-list>
            <ng-container *ngFor="let chapter of epoc.chapters | denormalize;let index = index">
                <ion-item class="level-1" [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id">
                    <ion-label>{{chapter.title}}</ion-label>
                </ion-item>
                <ng-container *ngFor="let content of chapter.contents | denormalize:epoc.contents;">
                    <ion-item class="level-2"
                              [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id+'/content/'+content.id">
                        <ion-icon *ngIf="content.type === 'html'" name="document-text-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'video'" name="play-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'assessment'" name="checkbox-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'simple-question' && !content.question.score"
                                  name="bulb-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'simple-question' && content.question.score"
                                  name="checkbox-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'choice'" name="git-branch-outline" slot="start"></ion-icon>
                        <ion-label>{{content.title}}</ion-label>
                    </ion-item>
                </ng-container>
            </ng-container>
        </ion-list>
    </ng-container>
    <ng-container *ngIf="!detailedToc">
        <div class="titleEpoc" [style.height]="platform.height() / (epoc.chapters | denormalize).length + 'px'"
             [style.font-size]="(this.platform.height() / 4) / ((epoc.chapters | denormalize).length) + 'px'">
            <b>{{epoc.title}}</b>
        </div>
        <div class="chapters">
            <div class="part"
                 *ngFor="let chapter of epoc.chapters | denormalize;
           let index = index"
                 [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id"
                 [style.height]="(this.platform.height() - 44 - (platform.height() / (epoc.chapters | denormalize).length) - 12 * (epoc.chapters | denormalize).length + 1)
                     / ((epoc.chapters | denormalize).length) + 'px'"
            >
                <ion-progress-bar color="success" [value]="this.chaptersFinished && this.chaptersFinished[index] ? 1 : 0">
                </ion-progress-bar>
                <ion-icon name="ellipse" [ngClass]="this.chaptersFinished && this.chaptersFinished[index] ? 'success' : 'neutral'">
                </ion-icon>
                <div class="rectangle"
                     [style.font-size]="(this.platform.height() / 5) / ((epoc.chapters | denormalize).length) + 'px'">
                    <b>{{epoc.parameters.chapterParameter ? epoc.parameters.chapterParameter : 'Chapitre'}} {{index + 1}}
                        : </b>
                    {{chapter.title}}
                </div>
            </div>
            <!-- <ion-grid>
               <ion-row>
                 <ion-col size="10" offset="1" size-md="6" offset-md="0"
                          *ngFor="let chapter of epoc.chapters | denormalize;let index = index">
                   <ion-card class="chapter" [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id">
                     <img [src]="(chapter.image ? libraryService.rootFolder +  chapter.image : 'assets/img/placeholder.png') | safe: 'url'"/>
                     <ion-card-content>
                       <b>{{epoc.parameters.chapterParameter? epoc.parameters.chapterParameter :'Chapitre'}} {{index + 1}} : </b> {{chapter.title}}
                     </ion-card-content>
                   </ion-card>
                   </ion-col>
               </ion-row>
             </ion-grid>-->
        </div>
    </ng-container>
</ion-content>

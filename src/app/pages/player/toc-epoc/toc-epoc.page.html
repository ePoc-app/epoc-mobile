<ion-header #header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button text="Retour" color="inria-blue"></ion-back-button>
        </ion-buttons>
        <ion-title>Tables des mati√®res</ion-title>
        <ion-toggle slot="end" color="inria-blue" [(ngModel)]="detailedToc"></ion-toggle>
    </ion-toolbar>
</ion-header>

<ion-content *ngIf="epoc$ | async as epoc">
    <ng-container *ngIf="detailedToc">
        <ion-list>
            <ng-container *ngFor="let chapter of epoc.chapters | denormalize;let index = index">
                <ion-item class="level-1" [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id">
                    <ion-label>{{chapter.title}}</ion-label>
                </ion-item>
                <ng-container *ngFor="let content of chapter.contents | denormalize:epoc.contents;">
                    <ion-item class="level-2"
                              [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id+'/content/'+content.id">
                        <ion-icon *ngIf="content.type === 'html'" name="document-text-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'video'" name="play-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'assessment'" name="checkbox-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'simple-question' && !content.question.score"
                                  name="bulb-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'simple-question' && content.question.score"
                                  name="checkbox-outline" slot="start"></ion-icon>
                        <ion-icon *ngIf="content.type === 'choice'" name="git-branch-outline" slot="start"></ion-icon>
                        <ion-label>{{content.title}}</ion-label>
                    </ion-item>
                </ng-container>
            </ng-container>
        </ion-list>
    </ng-container>
    <ng-container *ngIf="!detailedToc">
        <div class="head" [style.height]="platform.height() / (epoc.chapters | denormalize).length + 'px'">
            <div class="titleEpoc" [style.font-size]="fontSize + 5 + 'px'">
                <b>{{epoc.title}}</b>
            </div>
        </div>

        <div class="container">
            <div class="bar"></div>
            <div class="chapters">
                <div class="part"
                     *ngFor="let chapter of epoc.chapters | denormalize;
               let index = index"
                     [routerLink]="'/player/play/'+epoc.id+'/'+chapter.id"
                     [style.height]="height + 'px'"
                >
                    <ion-progress-bar
                        [buffer]="this.chaptersFinished && this.chaptersFinished[index] && this.assessmentDone && this.assessmentDone[index] ? 1 : 0">
                    </ion-progress-bar>
                    <ion-icon name="ellipse" [ngClass]="this.chaptersFinished && this.chaptersFinished[index] && this.assessmentDone && this.assessmentDone[index] ? 'chapter-completed' : 'chapter-uncompleted'">
                    </ion-icon>
                    <div class="rectangle">
                        <div [style.font-size]="fontSize + 'px'">
                            <b>{{epoc.parameters.chapterParameter ? epoc.parameters.chapterParameter : 'Chapitre'}} {{index + 1}}
                                : </b>
                            {{chapter.title}}
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</ion-content>

<ion-header #header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="router.navigateByUrl('/tabs/tab1');">
        <ion-icon name="arrow-back"></ion-icon>
        <ion-icon name="home"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title *ngIf="epoc$ | async as epoc"><small>{{epoc.title}}</small></ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon name="bookmark"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="hide-toolbar">
  <div class="hide-toolbar-wrapper">
    <ion-slides *ngIf="epoc$ | async as epoc" #slides [options]="slidesOptions" (ionSlideDidChange)="slideChanged(epoc)">
      <ion-slide *ngFor="let content of epoc.content">
        <div class="slide-content">

          <div class="cover-content" *ngIf="content.type === 'cover'">
            <ion-img [src]="epoc.image"></ion-img>
            <h2>{{epoc.title}}</h2>
            <div *ngFor="let author of epoc.authors">
              <ion-text>{{author.name}}</ion-text>
            </div>
            <div class="edition">2020 edition<br/>Inria Learning Lab</div>
          </div>

          <div class="chapter-content" *ngIf="content.type === 'chapter'">
            <div class="chapter-square"><div class="chapter-number">{{content.number}}</div></div>
            <div class="chapter-title">{{content.name}}</div>
          </div>

          <div class="html-content" *ngIf="content.type === 'html'">
            <div class="title">
              <h2>{{content.name}}</h2>
            </div>
            <div class="value" [innerHTML]="content.value"></div>
          </div>

          <div class="assessment-content" *ngIf="content.type === 'assessment'">
            <form #assessmentForm="ngForm" (ngSubmit)="onSubmit(assessmentForm, content.items)">
              <div class="title"><span>Assessment</span></div>
              <div class="score">
                <div class="score-bubble">
                  <span class="score-number">{{content.score}}</span>
                  <span class="score-points">points</span>
                </div>
              </div>
              <div class="assessment-items">
                <div class="assessment-item" *ngFor="let assessment of content.items; let assessmentIndex = index;">

                  <div class="assessment-choice" *ngIf="assessment.type === 'choice'">
                    <div>
                      <b>{{assessment.label}}</b>
                    </div>
                    <ion-radio-group class="assessment-choice-responses" [name]="'choice-'+assessmentIndex" ngModel>
                      <ion-item class="assessment-choice-response" [lines]="'none'" *ngFor="let response of assessment.responses">
                        <ion-radio mode="md" slot="start" [value]="response.value"></ion-radio>
                        <ion-label class="ion-text-wrap">{{response.label}}</ion-label>
                      </ion-item>
                    </ion-radio-group>
                  </div>

                  <div class="assessment-multiple-choice" *ngIf="assessment.type === 'multipleChoice'">
                    <div>
                      <b>{{assessment.label}}</b>
                    </div>
                    <div class="assessment-choice-responses">
                      <ion-item class="assessment-choice-response" [lines]="'none'" *ngFor="let response of assessment.responses">
                        <ion-checkbox mode="md" slot="start" [value]="response.value" name="multipleChoice[]" ngModel></ion-checkbox>
                        <ion-label class="ion-text-wrap">{{response.label}}</ion-label>
                      </ion-item>
                    </div>
                  </div>

                </div>
              </div>
              <ion-text color="danger" *ngIf="displayTryagain"><ion-icon name="close-circle-outline"></ion-icon> Wrong answer</ion-text>
              <ion-text color="success" *ngIf="displayResume"><ion-icon name="close-circle-outline"></ion-icon> Correct answer</ion-text>
              <ion-button class="submit-responses" type="submit" expand="block" *ngIf="displaySubmit">Submit</ion-button>
              <ion-button class="tryagain" color="danger" expand="block" *ngIf="displayTryagain" (click)="tryAgain(assessmentForm)">Try again</ion-button>
              <ion-button class="tryagain" color="success" expand="block" *ngIf="displayResume" (click)="resume()">Resume</ion-button>
            </form>
          </div>

        </div>
      </ion-slide>
    </ion-slides>
  </div>
</ion-content>

<ion-footer #footer>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button>
        <ion-icon size="large" name="list"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon size="large" name="more"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
